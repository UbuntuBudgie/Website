---
import { getCollection } from "astro:content";

const galleryImages = [
  { src: '/screens/mainscreen.jpg', alt: 'Ubuntu Budgie desktop showing a dark theme with a calendar app.', caption: 'The clean and intuitive Budgie desktop environment.' },
  { src: '/gallery/fullscreenmenu.webp', alt: 'App menu launcher displaying various applications in a grid view.', caption: 'Finding your favorite applications is fast and easy.' },
  { src: '/gallery/quicknote.jpg', alt: 'Screenshot of quick note applet.', caption: 'Quick Note applet allows you to paste anything you may need soon' },
  { src: '/gallery/sidebar.png', alt: 'A detailed shot of the Raven sidebar notification center.', caption: 'Raven sidebar for notifications and quick settings.' },
  { src: '/gallery/installer.jpg', alt: 'Ubuntu Budgie Installer', caption: 'Easily install Ubuntu Budgie via GUI installer.' },
  { src: '/gallery/power.png', alt: 'Power settings to manage system power usage.', caption: 'Power settings' },
  { src: '/gallery/greeter.png', alt: 'Visual pleasing Login Screen.', caption: 'Simple to login' },
  { src: '/gallery/classicmenu.png', alt: 'Classical Start Menu in Budgie', caption: 'Classic Start Menu' },
  { src: '/gallery/fluent-lightdark.jpg', alt: 'Fluent Light and Dark Theme Look', caption: 'Fluent Light and Dark Theme' },
  { src: '/gallery/systemoverview.png', alt: 'System Overview Information Panel', caption: 'System Overview' },
  { src: '/gallery/arm.png', alt: 'Budgie ARM TweakTool Customization', caption: 'Budgie ARM TweakTool Overview' },
  { src: '/gallery/action.png', alt: 'Quick Action Menu', caption: 'Quick Action Menu' },
  { src: '/gallery/rclock.png', alt: 'Raven Clock Widget', caption: 'Raven Clock' },
  { src: '/gallery/hotcorner.png', alt: 'Hot Corner Menu Settings', caption: 'Hot Corner Menu' },
  { src: '/gallery/wal.png', alt: 'Weather Applet Light Theme', caption: 'Weather Applet Light' },
  { src: '/gallery/wad.png', alt: 'Weather Applet Dark Theme', caption: 'Weather Applet Dark' },
  { src: '/gallery/hca.png', alt: 'Hot Corner Applet', caption: 'Hot Corner Applet' },
  { src: '/gallery/settings.png', alt: 'Budgie Settings', caption: 'Budgie Theme Settings' },
  { src: '/gallery/screenshot.png', alt: 'Screenshot Applet', caption: 'Screenshot Applet Settings' },
  { src: '/gallery/ssas.png', alt: 'Screenshot Applet Settings', caption: 'Screenshot Applet Image Settings' },
  { src: '/gallery/tal.png', alt: 'Ubuntu Budgie Welcome Themes and Layouts', caption: 'Themes and Layouts' },
  { src: '/gallery/bw.jpg', alt: 'Ubuntu Budgie Welcome', caption: 'Ubuntu Budgie Welcome' },
  { src: '/gallery/ubg.jpg', alt: 'Ubuntu Budgie Welcome Gaming Section', caption: 'Ubuntu Budgie Welcome - Gaming' },
  { src: '/gallery/extras.jpg', alt: 'Ubuntu Budgie Welcome Extras Section', caption: 'Ubuntu Budgie Welcome - Extras' },
  { src: '/gallery/exmenu.png', alt: 'Ubuntu Budgie Extended Menu', caption: 'Extended Menu' },
  { src: '/gallery/bsettings.png', alt: 'Ubuntu Budgie Settings', caption: 'Settings' },
  { src: '/gallery/hotcorners.webp', alt: 'Hotcorners Applet Actions', caption: 'Hotcorners Actions' },
  { src: '/gallery/shuffler.png', alt: 'Shuffler Applet', caption: 'Shuffler Applet' },
  { src: '/gallery/backup.png', alt: 'Backup Application', caption: 'Backup Application' },
];

const numImages = galleryImages.length;
let gridCols = "grid-cols-2 sm:grid-cols-3";
if (numImages > 3) gridCols = "grid-cols-2 sm:grid-cols-3 lg:grid-cols-4";
---

<div
  x-data={`{ 
    isModalOpen: false, 
    currentIndex: 0,
    images: ${JSON.stringify(galleryImages)},
    touchStartX: 0,
    touchEndX: 0,
    
    openModal(index) { 
        this.currentIndex = index; 
        this.isModalOpen = true; 
    },
    
    closeModal() { 
        this.isModalOpen = false; 
    },
    
    next() {
        this.currentIndex = (this.currentIndex + 1) % this.images.length;
    },
    
    prev() {
        this.currentIndex = (this.currentIndex - 1 + this.images.length) % this.images.length;
    },

    handleTouchStart(e) {
        this.touchStartX = e.changedTouches[0].screenX;
    },

    handleTouchEnd(e) {
        this.touchEndX = e.changedTouches[0].screenX;
        this.handleSwipe();
    },

    handleSwipe() {
        if (this.touchEndX < this.touchStartX - 50) {
            this.next(); // Swipe Left to go Next
        }
        if (this.touchEndX > this.touchStartX + 50) {
            this.prev(); // Swipe Right to go Prev
        }
    }
  }`}
  @keydown.escape.window="closeModal()"
  @keydown.right.window="if(isModalOpen) next()"
  @keydown.left.window="if(isModalOpen) prev()"
  class="py-20 lg:py-32"
>
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">

    <!-- Header -->
    <div class="max-w-3xl mx-auto text-center mb-16 sm:mb-24">
      <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-base-900">
        Ubuntu Budgie Gallery
      </h1>
      <p class="mt-4 text-lg text-base-500">
        A visual showcase of the Budgie Desktop Environment. Click any image to view it in full size.
      </p>
    </div>

    <!-- Gallery Grid -->
    <div class={`grid ${gridCols} gap-4`}>
      {galleryImages.map((image, index) => (
        <div 
          class="group block relative overflow-hidden rounded-lg cursor-pointer shadow-lg hover:shadow-xl transition-shadow duration-300"
          @click={`openModal(${index})`}
          @keydown.enter={`openModal(${index})`}
          role="button"
          tabindex="0"
          aria-label={`View ${image.caption}`}
        >
          <img 
            src={image.src} 
            alt={image.alt} 
            class="w-full h-40 sm:h-48 object-cover bg-gray-100 rounded-lg transition-transform duration-300 transform group-hover:scale-105" 
            loading="lazy"
          />
          
          <!-- View overlay -->
          <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
            <div class="flex items-center gap-x-1.5 py-1.5 px-2.5 bg-white/90 border border-gray-200 text-gray-800 rounded-lg shadow-sm">
              <svg class="shrink-0 w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.3-4.3"/></svg>
              <span class="text-xs font-medium">View</span>
            </div>
          </div>

          <!-- Caption -->
          <div class="absolute bottom-0 inset-x-0 p-3 bg-white/90 rounded-b-lg border-t border-gray-200">
            <p class="text-xs text-gray-700 font-medium truncate">{image.caption}</p>
          </div>
        </div>
      ))}
    </div>

  </div>

  <!-- Alpine.js Lightbox Modal -->
  <template x-teleport="body">
    <div 
      x-show="isModalOpen"
      x-transition:enter="ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/90 backdrop-blur-sm"
      aria-labelledby="modal-title" 
      role="dialog" 
      aria-modal="true"
      @touchstart="handleTouchStart"
      @touchend="handleTouchEnd"
    >
      <!-- Close Button (Top Right) -->
      <button 
        @click="closeModal()" 
        class="absolute top-4 right-4 z-50 text-white/70 hover:text-white bg-black/50 hover:bg-black/80 rounded-full p-2 transition focus:outline-none"
        aria-label="Close gallery"
      >
        <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>

      <!-- Previous Button (Left) -->
      <button 
        @click.stop="prev()" 
        class="absolute left-2 md:left-8 top-1/2 -translate-y-1/2 z-50 p-3 text-white/70 hover:text-white bg-black/30 hover:bg-black/60 rounded-full transition focus:outline-none hidden sm:block"
        aria-label="Previous image"
      >
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
      </button>

      <!-- Next Button (Right) -->
      <button 
        @click.stop="next()" 
        class="absolute right-2 md:right-8 top-1/2 -translate-y-1/2 z-50 p-3 text-white/70 hover:text-white bg-black/30 hover:bg-black/60 rounded-full transition focus:outline-none hidden sm:block"
        aria-label="Next image"
      >
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
      </button>

      <!-- Modal Content Container -->
      <div 
        class="relative w-full max-w-5xl h-full flex flex-col justify-center items-center"
        @click.outside="closeModal()"
      >
        <!-- Image with subtle transition -->
        <div class="relative w-full max-h-[85vh] flex justify-center items-center overflow-hidden">
            <img 
                :key="currentIndex"
                :src="images[currentIndex].src" 
                :alt="images[currentIndex].alt"
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-50 scale-95"
                x-transition:enter-end="opacity-100 scale-100"
                class="max-w-full max-h-[80vh] sm:max-h-[85vh] object-contain rounded shadow-2xl select-none"
            />
        </div>
        
        <!-- Caption -->
        <div class="mt-4 text-center px-4">
            <p class="text-white text-lg font-medium tracking-wide" x-text="images[currentIndex].caption"></p>
            <p class="text-gray-400 text-sm mt-1">
                <span x-text="currentIndex + 1"></span> / <span x-text="images.length"></span>
            </p>
        </div>
      </div>
    </div>
  </template>
</div>